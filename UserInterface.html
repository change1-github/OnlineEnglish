<!DOCTYPE html>
<html>

<head>
	<meta name="version" content="v2.10.3">
  <!-- <meta http-equiv="refresh", content="5"> -->

	<base target="_top">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous">
	</script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js">
	</script>

</head>

<body>
	<button onclick='testScript()'>Test Script</button>
	<script>
		function testScript()
      {
        // console.log(google.script.run.sortTasks());
      }
      
      function saveFile(f,aId,sId) 
      {
        const file = f.files[0];
        const fr = new FileReader();
        fr.onload = function(e) {
          const obj = {
            filename: aId+'_'+sId,
//            filename: file.name,
            mimeType: file.type,
            bytes: [...new Int8Array(e.target.result)]
          };
        //   google.script.run.withSuccessHandler(e => console.log(e)).saveFile(obj);
          
        };
        fr.readAsArrayBuffer(file);
      }
	</script>

	<h2> Sorted Tasks </h2>
	<? var data = sortTasks(); ?>
	<div class="container">
		<div class="row">
			<div class="col">
				<table id='students' class="table table-striped">
					<thead>
						<tr>
							<th style="width: 10%">Upload</th>
							<th style="width: 10%">[ Task ID ]</th>
							<th style="width: 0%">[ Student ID ]</th>
							<th style="width: 20%">Task Title</th>
							<th style="width: 20%">File Name</th>
							<th style="width: 15%"> Upload Time</th>
							<th style="width: 10%"> Upload Link</th>
						</tr>
					</thead>
					<tbody>
						<!-- <? for (var i = 0; i < data.length; i++) { ?>
						<tr>
							<td>
								<input id="file" type="file" onchange="saveFile(this,<?= data[i][0] ?>,<?= data[i][1] ?>)"/>
            </td>
								<? for (var j = 0; j < data[i].length; j++) { ?>

							<td>

								<? if(data[i][j].toString().startsWith("https")==true){?>
								<a target="_blank" href=<?=data[i][j]?>>Link </a>
								<? } else { ?>
								<?=data[i][j] ?>
								<? } ?>
							</td>
							<? } ?>
						</tr>
						<? } ?> -->
					</tbody>
				</table>
			</div>
		</div>
	</div>
</body>

<script>
	$(document).ready( function () {
    //sort table
    $('#students').DataTable( { 
      "order": [ [ 1, "asc" ] ] ,
      //hide Student ID col
      "columnDefs": [ { "visible": false, "targets": 2 } ]
    } ) ;
    
    //hide some columns for sub-assignemnts
    var charts=document.getElementById('students');
    var rows = charts.getElementsByTagName('tr');   
    for( var row of rows){  
      var tds = row.getElementsByTagName('td');
      if(tds[4] != undefined)         //shift upload time 
        tds[4].setAttribute("style", "text-align: right");
      if(tds[5] !=undefined)          //hide repetitive columns
        if(tds[5].textContent.trim().length>0)
        {
          tds[0].getElementsByTagName("input")[0].setAttribute("style","visibility : hidden");
          for(var i = 1 ; i<3 ; i++)
            tds[i].setAttribute("style", "color: rgba(0,0,0,0)")
        }

      //reload iframe
      // setTimeout(
      //     function(){
      //       parent.location.reload();
      //     },
      //     50000
      // );
    }


  });
</script>

</html>